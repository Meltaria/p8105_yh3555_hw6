p8105_yh3555_hw6
================
Yuchen Hua
2022-11-28

## Problem 2

Import data

``` r
homicide = read.csv("./data./homicide-data.csv")
```

Date cleaning

``` r
homicide_clean = homicide %>%
  mutate(city_state = str_c(city, ",", state)) %>%
  mutate(city_state = as.factor(city_state)) %>%
  mutate(victim_age = as.numeric(victim_age)) %>%
  group_by(city_state, disposition) %>% 
  filter(!city_state %in% c("Dallas,TX", "Phoenix,AZ", "Kansas City,MO", "Tulsa,AL"),
         !victim_age %in% c(NA),
         !victim_sex %in% c("Unknown")) %>%
  filter(victim_race %in% c("Black", "White")) %>%
  mutate(resolved = ifelse(disposition %in% c("Closed by arrest"), 1, 0)) %>%
  select(-uid, -reported_date, -victim_last, -victim_first, -lat, -lon)
```

    ## Warning in mask$eval_all_mutate(quo): 强制改变过程中产生了NA

``` r
homicide_clean
```

    ## # A tibble: 39,362 × 8
    ## # Groups:   city_state, disposition [135]
    ##    victim_race victim_age victim_sex city        state disposi…¹ city_…² resol…³
    ##    <chr>            <dbl> <chr>      <chr>       <chr> <chr>     <fct>     <dbl>
    ##  1 White               15 Female     Albuquerque NM    Closed w… Albuqu…       0
    ##  2 White               72 Female     Albuquerque NM    Closed w… Albuqu…       0
    ##  3 White               91 Female     Albuquerque NM    Open/No … Albuqu…       0
    ##  4 White               56 Male       Albuquerque NM    Open/No … Albuqu…       0
    ##  5 White               43 Female     Albuquerque NM    Closed b… Albuqu…       1
    ##  6 White               52 Male       Albuquerque NM    Closed b… Albuqu…       1
    ##  7 White               22 Female     Albuquerque NM    Closed b… Albuqu…       1
    ##  8 Black               15 Male       Albuquerque NM    Closed b… Albuqu…       1
    ##  9 Black               25 Male       Albuquerque NM    Closed b… Albuqu…       1
    ## 10 White               20 Male       Albuquerque NM    Closed b… Albuqu…       1
    ## # … with 39,352 more rows, and abbreviated variable names ¹​disposition,
    ## #   ²​city_state, ³​resolved

If the case was closed by arrested, which was solved, it would be
labelled as 1. If Open/No arrest or Closed without arrest, it would be
labelled as 0.

For Baltimore,MD

``` r
baltimore_fit = homicide_clean %>%
  filter(city_state %in% c("Baltimore,MD")) %>%
  glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial())
baltimore_fit
```

    ## 
    ## Call:  glm(formula = resolved ~ victim_age + victim_race + victim_sex, 
    ##     family = binomial(), data = .)
    ## 
    ## Coefficients:
    ##      (Intercept)        victim_age  victim_raceWhite    victim_sexMale  
    ##         0.309981         -0.006727          0.841756         -0.854463  
    ## 
    ## Degrees of Freedom: 2752 Total (i.e. Null);  2749 Residual
    ## Null Deviance:       3568 
    ## Residual Deviance: 3493  AIC: 3501

``` r
baltimore_tidy = broom::tidy(baltimore_fit)
```

``` r
CI_baltimore = baltimore_fit %>%
  confint(level = 0.95)
```

    ## Waiting for profiling to be done...

``` r
OR_baltimore = baltimore_tidy %>%
  mutate(OR = exp(estimate)) %>%
  select(term, OR)
```

For all cities

``` r
cities_fit = homicide_clean %>%
  nest(data = -city_state) %>%
  mutate(
    models = map(data, ~glm(resolved ~ victim_age + victim_race + victim_sex, data= ., family = binomial())),
    results = map(models, broom::tidy)
  ) %>%
  select(-data, -models) %>%
  unnest(results) %>%
  filter(!term %in% c("(Intercept)"))
cities_fit
```

    ## # A tibble: 141 × 6
    ## # Groups:   city_state [47]
    ##    city_state     term               estimate std.error statistic  p.value
    ##    <fct>          <chr>                 <dbl>     <dbl>     <dbl>    <dbl>
    ##  1 Albuquerque,NM victim_age       -0.0197      0.00909 -2.16     3.04e- 2
    ##  2 Albuquerque,NM victim_raceWhite  0.412       0.416    0.990    3.22e- 1
    ##  3 Albuquerque,NM victim_sexMale    0.570       0.385    1.48     1.39e- 1
    ##  4 Atlanta,GA     victim_age       -0.0116      0.00466 -2.50     1.24e- 2
    ##  5 Atlanta,GA     victim_raceWhite  0.269       0.284    0.945    3.45e- 1
    ##  6 Atlanta,GA     victim_sexMale    0.0000771   0.194    0.000397 1.00e+ 0
    ##  7 Baltimore,MD   victim_age       -0.00673     0.00332 -2.02     4.30e- 2
    ##  8 Baltimore,MD   victim_raceWhite  0.842       0.175    4.82     1.45e- 6
    ##  9 Baltimore,MD   victim_sexMale   -0.854       0.138   -6.18     6.26e-10
    ## 10 Baton Rouge,LA victim_age       -0.00668     0.00775 -0.863    3.88e- 1
    ## # … with 131 more rows

## Problem 3

Import data

``` r
bw = read.csv("./data/birthweight.csv")
```
